name: Push Release Notes to Beamer

on:
  workflow_dispatch

jobs:
  push-release-notes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Get latest release
        id: latest_release
        run: |
          ACCESS_TOKEN="${{ secrets.MY_TOKEN }}"
          API_URL="https://api.github.com/repos/OWNER/REPO/releases/latest"
          RELEASE_DATA=$(curl -s -H "Authorization: Bearer $ACCESS_TOKEN" $API_URL)
          RELEASE_TAG=$(echo $RELEASE_DATA | jq -r '.tag_name')
          RELEASE_BODY=$(echo $RELEASE_DATA | jq -r '.body')
          echo "RELEASE_TAG=${RELEASE_TAG}" >> temp_file
          echo "RELEASE_BODY=${RELEASE_BODY}" >> temp_file

      - name: Set environment variables
        run: |
          echo "::set-env name=RELEASE_TAG::$(cat temp_file | grep RELEASE_TAG | cut -d'=' -f2)"
          echo "::set-env name=RELEASE_BODY::$(cat temp_file | grep RELEASE_BODY | cut -d'=' -f2)"

      - name: Print result
        run: |
          echo "Tag name: ${{ env.RELEASE_TAG }}"
          echo "Release body: ${{ env.RELEASE_BODY }}"
